<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>ASK&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录一些平时点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="ASK&#39;s Blog">
<meta property="og:url" content="https://ansike.github.io/blog/page/9/index.html">
<meta property="og:site_name" content="ASK&#39;s Blog">
<meta property="og:description" content="记录一些平时点滴">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ask">
<meta property="article:tag" content="ask">
<meta property="article:tag" content=" ansike">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="ASK&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/blog/icon/icon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">ASK&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">首页</a>
        
          <a class="main-nav-link" href="/blog/archives">归档</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-box-wrap">
        <div class="search-box">
  <div class="search-form">
    <input class="search-box-input" id="searchIpt" placeholder="Search" />
    <button type="submit" class="search-box-submit">&#xF002;</button>
  </div>
  <div class="search-result-box"></div>
</div>
 
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-编程/网络相关/基础概念-发展" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-%E5%8F%91%E5%B1%95/" class="article-date">
  <time datetime="2022-09-10T04:26:24.000Z" itemprop="datePublished">2022-09-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-%E5%8F%91%E5%B1%95/">基础知识-发展</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="什么是计算机网络"><a href="#什么是计算机网络" class="headerlink" title="什么是计算机网络"></a>什么是计算机网络</h3><p>像蜘蛛网一样多个节点通过线连接成的网状结构就是网络，而计算机网络就是多个网络设备（电脑，手机，路由器等）通过媒介（网线，wifi 等）连接到一起的网状结构就是一个计算机网络。</p>
<h3 id="计算机网络的发展"><a href="#计算机网络的发展" class="headerlink" title="计算机网络的发展"></a>计算机网络的发展</h3><ol>
<li>刚开始只是几个计算机直接直接连接，发送 01 信号即可完成计算机之前的通信</li>
<li>随着计算机的变多，计算机两两之间都通过直接连接会导致整个网络非常复杂，也不便于网络的扩展<br>为了解决这个问题，提出了两个比较好的设想<ol>
<li>转发：在多个计算机之间提出一个中心节点，计算机之间的访问都通过中心节点进行转发<ol>
<li>Hub（集线器）会将收到的消息进行网络内广播【物理层】<br>为了结局网络内的两台设备同时发送消息时会造成消息混杂，通过 CSMA/CD 协议进行解决（载波侦听没有其他消息时再进行发送）<br>缺点：<ol>
<li>数据广播会导致带宽利用率低</li>
<li>链路上同时只能有一个设备进行发送数据</li>
</ol>
</li>
<li>Switch（交换机）【数据链路层】<ol>
<li>优点<ol>
<li>可以记录 mac 地址和端口的映射关系，数据交换不再需要广播</li>
<li>全双工通信</li>
</ol>
</li>
<li>缺点<ol>
<li>单台交换机映射关系的量只能存储几千，查找 mac 地址的过程是广播的过程会导致<strong>消息洪泛</strong></li>
</ol>
</li>
</ol>
</li>
<li>Router（路由器）</li>
</ol>
</li>
<li>标识：<ol>
<li>mac 地址 标识设备</li>
<li>IP 地址 标识网络</li>
</ol>
</li>
</ol>
</li>
<li></li>
</ol>
<h3 id="hub-工作原理"><a href="#hub-工作原理" class="headerlink" title="hub 工作原理"></a>hub 工作原理</h3><p>hub 在收到一个数据包之后会在整个网络内进行广播，是物理层网络中心化组件，直接传输电信号。</p>
<h3 id="switch-工作原理"><a href="#switch-工作原理" class="headerlink" title="switch 工作原理"></a>switch 工作原理</h3><p>hub 在作为共享式的网络，一个时间只允许一个 session 传输数据，极易造成数据冲突。为了解决这种消息冲突的问题，设计了 switch 组件，基于数据链路层，在 switch 收到请求之后根据 mac-port 映射表，将数据转发到对应的主机上</p>
<p>交换机在内部会维护一张 mac 地址和端口的表，当网络中某一主机向另外一台主机发送数据时，会先查询交换机的映射表，如果能直接从表中查到 mac 地址（在数据帧的头部可以获取到源 MAC 地址和目的 MAC 地址）对应的端口，交换机会直接把数据包发送到对应的端口上。如果查询不到则会发送广播，目标主机做出响应之后再把 mac 地址和端口的映射关系记录在自己的映射表中。当然理解源目标主机和端口的映射关系在 switch 收到请求之后就可以做记录。</p>
<p>switch 替换掉 hub 的原因是 switch 支持全双工通信<br>作用在数据链路层中心化组件，这种就是一般说的两层交换机</p>
<h3 id="路由器的工作原理"><a href="#路由器的工作原理" class="headerlink" title="路由器的工作原理"></a>路由器的工作原理</h3><p>switch 中记录的数据是有上限的，跨网络时会有会导致频繁的广播，容易造成消息洪泛。为了解决这个问题，设计了路由器和 IP 网络，路由器作用在 IP 层，借助网络号和 IP 地址实现跨网络和主机通信</p>
<p>每个网络都有一个唯一的网络号，一个网络内的每台主机也都有一个唯一标识 IP 地址，<br>每台机器都有一个路由表</p>
<ul>
<li>同一网段内两台主机进行通信<br>路由器收到请求后会在当前网络内发送 ARP 请求，查找当前 IP 对应的 MAC 地址，源主机此时就可以拿到目标 MAC 地址直接进行数据交换</li>
<li>不同网段内两台主机进行通信<br>路由器收到请求后判断和当前网卡属于不同的网段，需要查找路由表上符合这个网段请求转发地址，通过另外一个网卡转发到对应的网络上，在对应网络上可以找到目标主机，多个节点之间通信通过 ARP 协议进行完成。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-%E5%8F%91%E5%B1%95/" data-id="clzmdspfu0092zwl1ce0hevlg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/网络相关/CIDR" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/CIDR/" class="article-date">
  <time datetime="2022-09-07T14:36:35.000Z" itemprop="datePublished">2022-09-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/CIDR/">CIDR</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="CIDR（Classless-Inter-Doamin-Routing-）-是什么？"><a href="#CIDR（Classless-Inter-Doamin-Routing-）-是什么？" class="headerlink" title="CIDR（Classless Inter-Doamin Routing ） 是什么？"></a>CIDR（Classless Inter-Doamin Routing ） 是什么？</h3><p>中文叫无类域间路由，是一种新的 IP 寻址方案，改进了 IP 地址的分配。它取代了 A，B，C 类旧系统，极大的延长了 IPV4 的使用寿命，减缓了路由表的增长速度。</p>
<h3 id="基于分类的-IP-地址问题"><a href="#基于分类的-IP-地址问题" class="headerlink" title="基于分类的 IP 地址问题"></a>基于分类的 IP 地址问题</h3><p>旧的寻址方法效率低下，消耗 IPV4 的速度更快，原有的类路由系统包括</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>IP 段</th>
<th>主机数</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>1.0.0.0-127.255.255.255</td>
<td>2^24-2</td>
</tr>
<tr>
<td>B</td>
<td>128.0.0.0-192.255.255.255</td>
<td>2^16-2</td>
</tr>
<tr>
<td>C</td>
<td>192.0.0.0-223.255.255.255</td>
<td>2^8-2</td>
</tr>
<tr>
<td>D</td>
<td>224.0.0.0-239.255.255.255</td>
<td>0</td>
</tr>
</tbody></table>
<p>在旧的寻址模式下当需要超过 254 台主机时，将不得不弃用 C 类地址选用 B 类</p>
<h3 id="CIDR-的工作原理"><a href="#CIDR-的工作原理" class="headerlink" title="CIDR 的工作原理"></a>CIDR 的工作原理</h3><p>CIDR 基于变长子网掩码（VLSM）。它可以定义任意长度的前缀。<br>CIDR 的 IP 地址分为两部分：</p>
<ol>
<li>前缀：192.168.0.0 表示当前网络的地址</li>
<li>后缀：24 表示当前网络地址占用的位数（从左往右）</li>
</ol>
<p>eg: 192.168.0.0/24<br>表示该网络的网络号是前 24 位 192.168.0，主机部分是后 8 位总共有 2^8-2（1-254）个主机位</p>
<p>将多个网路合并到一个路由（路由聚合）</p>
<ol>
<li>将多个 IP 地址聚合到一个之后，减小骨干路由的表项压力</li>
<li>减少 IP 地址的使用，缓解 IP 地址耗尽</li>
</ol>
<p><strong>例子</strong><br>有三个 IP 地址通过路由器进行转发<br>192.168.31.192/26<br>192.168.31.160/27<br>192.168.31.128/27<br>根据 CIDR 的模式可以寻找一个能涵盖所有 IP 地址的聚合地址进行转发：192.168.31.128/25<br>计算方法：查看三个 IP 地址他们从左往右完全相同位数有 25 位，我们保留相同的部分，把不同的位置位 0，就是我们需要的 IP 地址</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/CIDR/" data-id="clzmdspfu008ozwl1fscfcu2j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/k8s/debian环境搭建/debian安装k8s集群" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/debian%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/debian%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/" class="article-date">
  <time datetime="2022-08-20T06:34:47.000Z" itemprop="datePublished">2022-08-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/debian%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/debian%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/">多台debian组k8s集群</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="#环境说明">1. 环境说明</a><br><a href="#docker">2. 修改 docker 配置</a><br><a href="#proxy">3. 配置 proxy</a><br><a href="#k8s">4. 安装配置 k8s</a><br><a href="#install">5. 初始化集群</a><br><a href="#join">6. 其他机器加入集群</a><br><a href="#cni">7. 安装 cni</a></p>
<h3 id="环境说明">1. 环境说明</h3>

<ul>
<li>操作系统三台机器有 debian 10（两台）和 debian 9（一台）</li>
<li>Kubernetes v1.22.2</li>
<li>cni 插件 <a href="https://projectcalico.docs.tigera.io/manifests/canal.yaml" target="_blank" rel="noopener">https://projectcalico.docs.tigera.io/manifests/canal.yaml</a></li>
<li>docker 20.10.17</li>
</ul>
<h3 id="docker">2. 修改 docker 配置</h3>

<p>一台 debian10 做 master，其余两台做 worker</p>
<p>确保安装好 docker 之后，修改 daemon.json 文件<br>设置<code>/etc/docker/daemon.json</code><br>确保<code>native.cgroupdriver=systemd</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;/etc/docker/daemon.json&lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">    "insecure-registries": ["hub.xxx.org", "hub.xxx.org:443"],</span><br><span class="line">    "live-restore": true,</span><br><span class="line">    "exec-opts": ["native.cgroupdriver=systemd"],</span><br><span class="line">    "log-driver": "json-file",</span><br><span class="line">    "log-opts": &#123;</span><br><span class="line">        "max-size": "100m"</span><br><span class="line">    &#125;,</span><br><span class="line">    "storage-driver": "overlay2"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="proxy">3. 配置 proxy</h3>

<p>确保后续安装软件下载包的时候能顺畅的拉取资源<br>注意将自己的代理覆盖到对应的位置上</p>
<ol>
<li>系统 proxy</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export HTTP_PROXY="http://xxx:8118"</span><br><span class="line">export HTTPS_PROXY="http://xxx:8118"</span><br><span class="line">export NO_PROXY="127.0.0.1,localhost"</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>apt-get 的 proxy</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;/etc/apt/apt.conf.d/proxy.conf&lt;&lt;EOF</span><br><span class="line">Acquire &#123;</span><br><span class="line">  http::proxy "http://xxx:8118";</span><br><span class="line">  https::proxy "http://xxx:8118";</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>docker 中的 proxy</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/systemd/system/docker.service.d</span><br><span class="line">cat &gt;/etc/systemd/system/docker.service.d/proxy.conf&lt;&lt;EOF</span><br><span class="line">[Service]</span><br><span class="line">Environment="HTTP_PROXY=http://xxx:8118"</span><br><span class="line">Environment="HTTPS_PROXY=http://xxx:8118"</span><br><span class="line">Environment="NO_PROXY=127.0.0.1,localhost"</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>最后重启 docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="k8s">4. 安装配置 k8s</h3>

<p>数据盘映射 Kubelet 数据目录</p>
<ol>
<li>配置 kubelet 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /opt/kubelet</span><br><span class="line">sudo ln -s /opt/kubelet /var/lib/kubelet</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>环境准备</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新安装软件</span></span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install -y apt-transport-https curl</span><br><span class="line"><span class="meta">#</span><span class="bash"> 校验apt-key</span></span><br><span class="line">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改k8s配置</span></span><br><span class="line">sudo cat &gt;/etc/apt/sources.list.d/kubernetes.list&lt;&lt;EOF</span><br><span class="line">deb https://apt.kubernetes.io/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> 更新软件</span></span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装 k8s</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装1.22.2版本</span></span><br><span class="line">sudo apt-get install -qy kubelet=1.22.2-00 kubectl=1.22.2-00 kubeadm=1.22.2-00</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先启动好 kubelet</span></span><br><span class="line">sudo apt-mark hold kubelet kubeadm kubectl</span><br><span class="line">sudo systemctl enable kubelet</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 预先拉取需要的镜像</span></span><br><span class="line">kubeadm config images pull</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果下载失败，确认一下proxy的代理是不是有问题</span></span><br></pre></td></tr></table></figure>

<h3 id="install">5. 初始化集群</h3>

<ol>
<li>创建 kubeadm 配置文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 打印init的默认配置</span></span><br><span class="line">kubeadm config print init-defaults</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以下为kubeadm启动的默认配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 需要变更两个配置才能run起来</span></span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 1.2.3.4</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: /var/run/dockershim.sock</span><br><span class="line">  imagePullPolicy: IfNotPresent</span><br><span class="line">  name: node</span><br><span class="line">  taints: null</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns: &#123;&#125;</span><br><span class="line">etcd:</span><br><span class="line">  local:</span><br><span class="line">    dataDir: /var/lib/etcd</span><br><span class="line">imageRepository: k8s.gcr.io</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: 1.22.0</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br><span class="line">scheduler: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>变更内容</p>
<ol>
<li>修改 advertiseAddress 为当前机器的 ip</li>
<li>networking 下增加 podSubnet: 192.168.0.0/16</li>
</ol>
<p><strong>以我机器为例，最后配置为</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 10.37.156.156</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: /var/run/dockershim.sock</span><br><span class="line">  imagePullPolicy: IfNotPresent</span><br><span class="line">  name: node</span><br><span class="line">  taints: null</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io/v1beta3</span><br><span class="line">certificatesDir: /etc/kubernetes/pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns: &#123;&#125;</span><br><span class="line">etcd:</span><br><span class="line">  local:</span><br><span class="line">    dataDir: /var/lib/etcd</span><br><span class="line">imageRepository: k8s.gcr.io</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: 1.22.0</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br><span class="line">  podSubnet: 192.168.0.0/16</span><br><span class="line">scheduler: &#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>init 运行成功后,按提示配置好 KubeConfig 文件</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME&#x2F;.kube</span><br><span class="line">sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看 node 和 pod</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line">kubectl get pod -A</span><br></pre></td></tr></table></figure>

<h3 id="join">6. 其他机器加入集群</h3

<p>copy 初始化集群之后的一个打印信息，类似</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 10.37.156.156:6443 --token 8wybtt.440uq1zn3srp3hq0 \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:3fa7db3b64f15f1c99bb075dc1410cefd13d715aaecb5e646a69b17c3a3a186f</span><br></pre></td></tr></table></figure>

<p>在另外的 worker 机器上执行<br>然后在 master 上查看注册的 node，可以看到刚才注册进来的 node</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> NAME    STATUS   ROLES                  AGE   VERSION</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> node1   Ready    &lt;none&gt;                 61m   v1.22.2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master  Ready    control-plane,master   64m   v1.22.2</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> node2   Ready    &lt;none&gt;                 63m   v1.22.2</span></span><br></pre></td></tr></table></figure>

<h3 id="cni">7. 安装cni</h3>

<p>但此时集群内部还无法通信，需要安装 container network interface</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 文件较大，建议先下下来</span></span><br><span class="line">curl -O -k "https://projectcalico.docs.tigera.io/manifests/canal.yaml"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑canal的net配置 net-conf.json</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 确保Network 和集群初始化时的 podSubnet 网段一致 192.168.0.0/16</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> net-conf.json: |</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       <span class="string">"Network"</span>: <span class="string">"192.168.0.0/16"</span>,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       <span class="string">"Backend"</span>: &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">         <span class="string">"Type"</span>: <span class="string">"vxlan"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       &#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">     &#125;</span></span><br><span class="line"></span><br><span class="line">kubectl apply -f canal.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 很快就能看到coredns状态变为running</span></span><br><span class="line">kubectl get pod -A</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   calico-kube-controllers-86c9c65c67-dz4hk   1/1     Running   0          57m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   canal-7fp55                                2/2     Running   0          57m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   canal-gkrdl                                2/2     Running   0          57m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   canal-stzzp                                2/2     Running   0          56m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   coredns-78fcd69978-5chrp                   1/1     Running   0          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   coredns-78fcd69978-z7zkg                   1/1     Running   0          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   etcd-node                                  1/1     Running   1          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   kube-apiserver-node                        1/1     Running   1          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   kube-controller-manager-node               1/1     Running   0          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   kube-proxy-874gz                           1/1     Running   0          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   kube-proxy-gcb9h                           1/1     Running   0          56m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   kube-proxy-lg6wc                           1/1     Running   0          58m</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kube-system   kube-scheduler-node                        1/1     Running   1          58m</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/k8s/debian%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/debian%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/" data-id="clzmdspi900fnzwl1gsapgniw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/debian/" rel="tag">debian</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/redis/Redis加锁的几种实现" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/redis/Redis%E5%8A%A0%E9%94%81%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0/" class="article-date">
  <time datetime="2022-08-14T01:19:18.000Z" itemprop="datePublished">2022-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/redis/Redis%E5%8A%A0%E9%94%81%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0/">Redis加锁的几种实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="为什么-redis-需要加锁？"><a href="#为什么-redis-需要加锁？" class="headerlink" title="为什么 redis 需要加锁？"></a>为什么 redis 需要加锁？</h3><p>在开发中可能会遇到一些重复或者并发的请求，这些请求在遇到 redis 类的存储不加限制极有可能导致数据发生错乱。<br>举个例子：同时有 A(新增数据为[3,4])，B(新增数据为[5,6]) 请求到服务中需要修改 redis 中的数据 [1,2]，此时 A 和 B 拿到 redis 中的数据都是[1,2]，此时如果 A 先修改完成，那后边的 B 就会覆盖 A 的数据，反之 A 会覆盖 B 的修改。但是我们预期是 A 和 B 都要生效，最后的结果应该是 [1,2,3,4,5,6]，此时我们会想到出问题的点是并发的修改数据，那如果 A，B 串行修改数据肯定不会有问题。</p>
<p>其实仔细分析问题：该问题的关键是<strong>并发的获取数据，串行的修改数据</strong>（因为 redis 是不支持并行的修改数据的）。</p>
<p>那我们保证多个请求在获取数据上也是串行即可解决这个问题</p>
<p>假设我们需要修改的 redis 的 key 为 <code>ONLY_KEY</code></p>
<h3 id="方案一：标识锁"><a href="#方案一：标识锁" class="headerlink" title="方案一：标识锁"></a>方案一：标识锁</h3><p>在 redis 中用一个新的 key 去标识我要去修改的这个 key 是不是正在修改中.如果能获取到则说明是在修改中后续的请求都会被 pending。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">changeOnlyKey</span>(<span class="params">newVals</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">`ONLY_KEY`</span>;</span><br><span class="line">  <span class="keyword">const</span> flag_key = <span class="string">`<span class="subst">$&#123;key&#125;</span>_FLAG`</span>;</span><br><span class="line">  <span class="keyword">const</span> flag_key_val = <span class="string">`<span class="subst">$&#123;key&#125;</span>_FLAG&#125;`</span>;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    flag = !!(<span class="keyword">await</span> getRedisValue(flag_key));</span><br><span class="line">    <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">      <span class="comment">// 说明当前key没有被锁，直接设置标识符，进行加锁</span></span><br><span class="line">      <span class="keyword">await</span> setRedisValue(flag_key, flag_key_val);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 执行主流程代码，确保get和set都放在这块儿</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> curVal = <span class="keyword">await</span> getRedisValue(flag_key, flag_key_val);</span><br><span class="line">      <span class="comment">// 删除锁</span></span><br><span class="line">      <span class="keyword">await</span> delRedisValue(flag_key);</span><br><span class="line">      <span class="comment">// 可以跳出循环</span></span><br><span class="line">      flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 说明当前key被锁，正在处理中</span></span><br><span class="line">      <span class="comment">// 加一层sleep避免频繁抢锁</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          resolve(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了避免一个服务加锁之后因为服务的问题导致该锁不会被释放，我们可以假设这个 key 已经加上了过期时间 10s。</p>
<p>那这个方案目前有什么问题吗？<br>有个比较极端的问题：如果在执行第一个请求的过程中该锁过期了，下一个请求获取到了锁，如果此时前一个请求执行完成就会把锁给删除，此时极可能导致<strong>后续的请求快速涌入造成雪崩式的数据错乱</strong></p>
<h3 id="方案二：标识符-唯一锁"><a href="#方案二：标识符-唯一锁" class="headerlink" title="方案二：标识符 + 唯一锁"></a>方案二：标识符 + 唯一锁</h3><p>锁还是采用 redis 标识，但是现在的锁要保证每次请求都是唯一的，只有正确的锁能被正确的请求打开和处理<br>我们在加锁时设置值唯一，删除锁时获取一下锁的值确保只删除我们自己的锁</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">changeOnlyKey</span>(<span class="params">newVals</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">`ONLY_KEY`</span>;</span><br><span class="line">  <span class="keyword">const</span> flag_key = <span class="string">`<span class="subst">$&#123;key&#125;</span>_FLAG`</span>;</span><br><span class="line">  <span class="keyword">const</span> flag_key_val = <span class="string">`<span class="subst">$&#123;key&#125;</span>_FLAG_<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    flag = !!(<span class="keyword">await</span> getRedisValue(flag_key));</span><br><span class="line">    <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">      <span class="comment">// 说明当前key没有被锁，直接设置标识符，进行加锁</span></span><br><span class="line">      <span class="keyword">await</span> setRedisValue(flag_key, flag_key_val);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 执行主流程代码，确保get和set都放在这块儿</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> curVal = <span class="keyword">await</span> getRedisValue(flag_key, flag_key_val);</span><br><span class="line">      <span class="comment">// 可以跳出循环</span></span><br><span class="line">      flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="comment">// 确保要删除的锁是自己加的，避免删除其他请求加的锁</span></span><br><span class="line">      <span class="keyword">if</span> (flag_key_val === curVal) &#123;</span><br><span class="line">        <span class="comment">// 删除锁</span></span><br><span class="line">        <span class="keyword">await</span> delRedisValue(flag_key);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 说明当前key被锁，正在处理中</span></span><br><span class="line">      <span class="comment">// 加一层sleep避免频繁抢锁</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          resolve(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时可能会有新的想法冒出来，即使加了唯一锁，前一个请求的锁失效，后一个请求立即进入，此时还是会发生数据错乱的。<br>这样的想法肯定是对的，所以我们要保证锁的过期时间一定要大于程序执行的时间，但是不能太大了避免一个节点断掉之后其他请求无法被及时处理。</p>
<h3 id="方案一：标识符-唯一锁-NX"><a href="#方案一：标识符-唯一锁-NX" class="headerlink" title="方案一：标识符 + 唯一锁 + NX"></a>方案一：标识符 + 唯一锁 + NX</h3><p>只是借助 redis 中 NX 的特性做的一个优化<br>NX 特性：如果当前 key 已经设置过那么再次设置时返回的值为 null<br>此时可以将一个 getredis 的操作给省略掉</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">changeOnlyKey</span>(<span class="params">newVals</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> key = <span class="string">`ONLY_KEY`</span>;</span><br><span class="line">  <span class="keyword">const</span> flag_key = <span class="string">`<span class="subst">$&#123;key&#125;</span>_FLAG`</span>;</span><br><span class="line">  <span class="keyword">const</span> flag_key_val = <span class="string">`<span class="subst">$&#123;key&#125;</span>_FLAG_<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 设置NX锁，没有设置过会返回true，已经设置过返回false</span></span><br><span class="line">    flag = !!(<span class="keyword">await</span> setRedisNXValue(flag_key, flag_key_val));</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">      <span class="comment">// 执行主流程代码，确保get和set都放在这块儿</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> curVal = <span class="keyword">await</span> getRedisNXValue(flag_key);</span><br><span class="line">      <span class="comment">// 可以跳出循环</span></span><br><span class="line">      flag = <span class="literal">true</span>;</span><br><span class="line">      <span class="comment">// 确保要删除的锁是自己加的，避免删除其他请求加的锁</span></span><br><span class="line">      <span class="keyword">if</span> (flag_key_val === curVal) &#123;</span><br><span class="line">        <span class="comment">// 删除锁</span></span><br><span class="line">        <span class="keyword">await</span> delRedisValue(flag_key);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 说明当前key被锁，正在处理中</span></span><br><span class="line">      <span class="comment">// 加一层sleep避免频繁抢锁</span></span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          resolve(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span> (!flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- TODO 真实代码 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/redis/Redis%E5%8A%A0%E9%94%81%E7%9A%84%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0/" data-id="clzmdspfk004wzwl1du538y8b" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-编程/网络相关/PORT" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/PORT/" class="article-date">
  <time datetime="2022-08-08T15:37:26.000Z" itemprop="datePublished">2022-08-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/PORT/">PORT</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="port-是什么？"><a href="#port-是什么？" class="headerlink" title="port 是什么？"></a>port 是什么？</h3><p>port 是一个逻辑概念，用来程序和服务进行数据交换，标识程序或者服务所在的位置。<br>port 使用唯一的数字标识，范围为 0-65535</p>
<h3 id="IP-和-port-关系"><a href="#IP-和-port-关系" class="headerlink" title="IP 和 port 关系"></a>IP 和 port 关系</h3><p>port 总是和 ip 一起出现，IP 确定服务所在的物理位置如主机或者服务器，port 确定所在机器上的服务或程序</p>
<p><strong>以<code>http://www.google.com</code>为例，解释服务的访问过程</strong><br>浏览器在发出请求时首先会将 google.com 解析为对应的 IP，因为使用了 HTTP 协议，默认使用 port 为 80，此时拿到 IP+PORT 即可找到对应的 server 或程序</p>
<h3 id="常见的-port？"><a href="#常见的-port？" class="headerlink" title="常见的 port？"></a>常见的 port？</h3><p>80 HTTP<br>443 HTTPS<br>21 FTP<br>22 SSH<br>25 Email（SMTP）</p>
<h3 id="port-分类？"><a href="#port-分类？" class="headerlink" title="port 分类？"></a>port 分类？</h3><p>0-1023 系统和常见的端口<br>1024-49151 可被开发者和和公司注册为特殊的服务<br>49152-655535 作为计算机临时 port 使用</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/PORT/" data-id="clzmdspfu008szwl1h4gi1mk5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/网络相关/基础概念" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" class="article-date">
  <time datetime="2022-08-08T14:50:41.000Z" itemprop="datePublished">2022-08-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/">基础知识</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="负载均衡中四层代理和七层代理是什么"><a href="#负载均衡中四层代理和七层代理是什么" class="headerlink" title="负载均衡中四层代理和七层代理是什么"></a>负载均衡中四层代理和七层代理是什么</h3><p>一句话说就是代理服务在 ISO 网络模型中的位置。<br>四层代理就是在 ISO 的第四层（传输层），基于 TCP/UDP 协议也就是[IP]:[端口]进行代理。<br>七层代理就是在 ISO 的第七层（应用层），基于应用层的协议也就是类似于 HTTP 的报文进行代理。</p>
<h4 id="网络模型。"><a href="#网络模型。" class="headerlink" title="网络模型。"></a>网络模型。</h4><p>网络分层一般来说 OSI 七层模型。从下往上看，第四层为传输层，第七层为应用层。</p>
<table>
<thead>
<tr>
<th>layer</th>
<th>protocol</th>
</tr>
</thead>
<tbody><tr>
<td>应用层</td>
<td>HTTP,DHCP,FTP,NFS,WAIS,TFTP</td>
</tr>
<tr>
<td>表示层</td>
<td>Telnet,Rlogin,SNMP,Gopher</td>
</tr>
<tr>
<td>会话层</td>
<td>SMTP,DNS</td>
</tr>
<tr>
<td>传输层</td>
<td>TCP,UDP</td>
</tr>
<tr>
<td>网络层</td>
<td>IP,ICMP,ARP,RARP,AKP,UUCP</td>
</tr>
<tr>
<td>数据链路层</td>
<td>以太网，帧中继，PPP，IEEE802.3</td>
</tr>
<tr>
<td>物理层</td>
<td>RS-232,RS-449,V.35,X.21</td>
</tr>
</tbody></table>
<h4 id="四层和七层的区别"><a href="#四层和七层的区别" class="headerlink" title="四层和七层的区别"></a>四层和七层的区别</h4><p>四层进行代理转发时会直接将 TCP 转发到后端服务上，只有一个 TCP 连接。收到请求后修改报文的目标地址，返回数据时修改源地址（根据需要）。性能较高。</p>
<p>七层进行代理转发时会在代理层进行数据解析，然后再向目标服务发起一个新的 TCP 请求，会有两个 TCP 连接。更细的转发规则实现。</p>
<h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ol>
<li>七层负载均衡：</li>
</ol>
<ul>
<li>服务更加智能化，可以将静态资源转发到特定的服务器，利用缓存达到更好的性能。</li>
<li>可以对请求和响应做完全的修改。提升应用系统在网络层的灵活性，如 header 请求重写，服务响应中关键字过滤或者内存插入。</li>
</ul>
<ol start="2">
<li>四层负载均衡：涉及比较底层的 C/S 服务可以使用</li>
</ol>
<h3 id="正向代理和反向代理"><a href="#正向代理和反向代理" class="headerlink" title="正向代理和反向代理"></a>正向代理和反向代理</h3><p>正向：客户端知道代理服务，也知道目标服务，通过代理服务向目标服务请求资源。前端开发中的目标服务 devServer 就是个正向代理服务<br>反向：客户端不知道代理服务，客户端以为访问的服务就是目标服务。nginx 做负载均衡时就是个反向代理服务</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" data-id="clzmdspfv0099zwl162paa9g7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/k8s/实验/deployment和svc实验" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E5%AE%9E%E9%AA%8C/deployment%E5%92%8Csvc%E5%AE%9E%E9%AA%8C/" class="article-date">
  <time datetime="2022-08-07T16:00:02.000Z" itemprop="datePublished">2022-08-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E5%AE%9E%E9%AA%8C/deployment%E5%92%8Csvc%E5%AE%9E%E9%AA%8C/">deployment和svc实验</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>实现 4 种 svc 的 demo</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br><span class="line"></span><br><span class="line">NAME              TYPE           CLUSTER-IP     EXTERNAL-IP        PORT(S)        AGE</span><br><span class="line">kubernetes        ClusterIP      10.96.0.1      &lt;none&gt;             443/TCP        8h</span><br><span class="line">myapp-clusterip   ClusterIP      10.108.249.7   &lt;none&gt;             80/TCP         13m</span><br><span class="line">myapp-headless    ClusterIP      None           &lt;none&gt;             80/TCP         13m</span><br><span class="line">myapp-nodeport    NodePort       10.104.3.44    &lt;none&gt;             80:31515/TCP   31m</span><br><span class="line">mysvc-1           ExternalName   &lt;none&gt;         ansike.github.io   &lt;none&gt;         31m</span><br></pre></td></tr></table></figure>

<h3 id="步骤实现一个-server，需要操作步骤"><a href="#步骤实现一个-server，需要操作步骤" class="headerlink" title="步骤实现一个 server，需要操作步骤"></a>步骤实现一个 server，需要操作步骤</h3><ul>
<li>创建 backend 的 deployment，副本数为 3</li>
<li>创建一个 service，指向 backend 的服务</li>
<li>将服务对外暴露</li>
</ul>
<p><strong>外部可以访问当前暴露服务的实现原理</strong></p>
<ol>
<li>创建 service 时 kubectl 向 apiServer 发送创建 service 的命令，apiServer 将数据存储到 etcd 中</li>
<li>kubernetes 中每个 node 都有一个叫 kube-proxy 的进程，该进程负责感知 service 和 pod 的变化，并将变化的信息写入 ipvs 中</li>
<li>ipvs 使用 nat 技术将 virtual 的流量转至 endpoint 中</li>
</ol>
<h3 id="为什么需要无头服务？"><a href="#为什么需要无头服务？" class="headerlink" title="为什么需要无头服务？"></a>为什么需要无头服务？</h3><ol>
<li>客户端想要和指定的的 Pod 直接通信，在集群内部可以通过[serviceName].[namespace].svc.cluster.local直接访问服务</li>
<li>开发人员希望自己控制负载均衡的策略，不使用 Service 提供的默认的负载均衡的功能，或者应用程序希望知道属于同组服务的其它实例。</li>
</ol>
<h3 id="CNAME-和-A-记录分别是什么意思？"><a href="#CNAME-和-A-记录分别是什么意思？" class="headerlink" title="CNAME 和 A 记录分别是什么意思？"></a>CNAME 和 A 记录分别是什么意思？</h3><p>A: Address 记录。域名和IP之间的映射关系。通过A记录可以将主机名或域名解析到对应的 IP 地址。如我们/etc/hosts 文件中配置的 host 解析。<br>CNAME: 别名记录。域名和域名之间的映射关系。如访问<a href="http://www.baidu.com实际上会转发到www.a.shifen.com上。" target="_blank" rel="noopener">www.baidu.com实际上会转发到www.a.shifen.com上。</a><br>MX: 邮件交换记录。发送电子邮件时服务器地址<br>NS: 解析服务器记录。表明由哪台服务器对域名进行解析。NS 记录只对子域名生效，NS 优先级高于 A 记录</p>
<p><strong>A 和 CNAME 使用场景:</strong></p>
<ol>
<li>CNAME 适用于大型站点多多负载</li>
</ol>
<p>CNAME 将多个地址映射到一个地址，这个地址再根据 A 记录进行实际 IP 地址的映射。A 记录优先级高于 CNAME</p>
<ul>
<li>服务器发生变更之后，需要同步修改多个域名的 A 记录。如果有 CNAME 的话，只需修改 CNAME 对应服务器的解析就可以。</li>
<li>降低多域名、多服务器、多业务的运维成本</li>
</ul>
<ol start="2">
<li>A 记录适合场景单一的业务 IP 不经常变动，不需要输入 www 也可访问对应的服务。</li>
</ol>
<h3 id="代码位置"><a href="#代码位置" class="headerlink" title="代码位置"></a>代码位置</h3><p><a href="https://github.com/ansike/k8s-script/tree/main/experiment/exp1" target="_blank" rel="noopener">https://github.com/ansike/k8s-script/tree/main/experiment/exp1</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E5%AE%9E%E9%AA%8C/deployment%E5%92%8Csvc%E5%AE%9E%E9%AA%8C/" data-id="clzmdspi700evzwl15f7vdl0z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/k8s/k8sService" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/k8sService/" class="article-date">
  <time datetime="2022-08-06T15:59:06.000Z" itemprop="datePublished">2022-08-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/k8sService/">service(svc)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="svc-概念"><a href="#svc-概念" class="headerlink" title="svc 概念"></a>svc 概念</h3><p>通过 label selector 匹配一组 pod，对外提供服务的一个机制。每个 svc 相当于一个微服务。</p>
<p>svc 会根据 label 去查找 pod，一旦匹配到 pod 中有 svc 中的全部 label，那么就会把 pod 的 ip 写入 svc 中</p>
<p>只提供 4 层负载均衡能力，没有 7 层（主机名和域名）。只能基于 ip 和端口进行转发</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ol>
<li>ClusterIp: 默认类型，分配一个 cluster 内部的虚拟 IP</li>
<li>headless 是一种特殊的 ClusterIP，不想受</li>
<li>Nodeport: 在 cluster 为 service 在每台机器上绑定一个端口，可以通过&lt;NodeIP&gt;:NodePort 进行访问</li>
<li>LoadBalancer: 在 NodePort 的基础上，借助 cloud provider 创建一个外部的负载均衡器，讲请求转发到 pod 上</li>
<li>ExternalName: 把集群外部的服务引入到集群内部来，在集群内部直接使用。</li>
</ol>
<h3 id="VIP-和-service-代理"><a href="#VIP-和-service-代理" class="headerlink" title="VIP 和 service 代理"></a>VIP 和 service 代理</h3><p>为什么不用 round-robin DNS 做负载？<br>因为 dns 会缓存，无法切换服务，没有办法做负载均衡</p>
<p>每个 node 运行一个 kube-proxy，kube-proxy 负责为 service 实现了一种 VIP（虚拟 IP）的形式。kubernets 1.14 版本之后代理默认是 ipvs</p>
<p>代理模式的分类</p>
<ol>
<li>userspace</li>
<li>iptables</li>
<li>ipvs（最新）</li>
</ol>
<p>4 层负载均衡和 7 层负载均衡是什么？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/k8s/k8sService/" data-id="clzmdspfi0048zwl19l7a83rq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/k8s/环境搭建相关/Centos系统初始化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/Centos%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96/" class="article-date">
  <time datetime="2022-08-06T15:59:06.000Z" itemprop="datePublished">2022-08-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/Centos%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96/">Centos系统初始化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="设置系统主机名以及-Host-文件的相互解析"><a href="#设置系统主机名以及-Host-文件的相互解析" class="headerlink" title="设置系统主机名以及 Host 文件的相互解析"></a>设置系统主机名以及 Host 文件的相互解析</h3><p>hostnamectl set-hostname k8s-master01</p>
<h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y conntrack ntpdate ntp ipvsadm ipset jq iptables curl sysstat libseccomp wget vim</span><br><span class="line">net-tools git</span><br></pre></td></tr></table></figure>

<h3 id="设置防火墙为-Iptables-并设置空规则"><a href="#设置防火墙为-Iptables-并设置空规则" class="headerlink" title="设置防火墙为 Iptables 并设置空规则"></a>设置防火墙为 Iptables 并设置空规则</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">yum -y install iptables-services &amp;&amp; systemctl start iptables &amp;&amp; systemctl enable iptables \</span><br><span class="line">&amp;&amp; iptables -F &amp;&amp; service iptables save</span><br></pre></td></tr></table></figure>

<h3 id="关闭-SELINUX"><a href="#关闭-SELINUX" class="headerlink" title="关闭 SELINUX"></a>关闭 SELINUX</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a &amp;&amp; sed -i '/ swap / s/A\(._\)$/#\l/g' /etc/fstab</span><br><span class="line">setenforce 0 &amp;&amp; sed -i 's/ASELINUX=._/SELINUX=disabled/' /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h3 id="调整内核参数，对于-K8S"><a href="#调整内核参数，对于-K8S" class="headerlink" title="调整内核参数，对于 K8S"></a>调整内核参数，对于 K8S</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubernetes.conf &lt;&lt;EOF</span><br><span class="line">net.bridge.bridge-nf-call-iptables=l</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=l</span><br><span class="line">net. ipv4.ip_forward=l</span><br><span class="line">net.ipv4.tcp_tw_recycle=0</span><br><span class="line">vm.swappiness=0 #禁止使用 swap 空间，只有当系统 00M 时才允许使用它</span><br><span class="line">vm. overcommit_memory=l #不检查物理内存是否够用</span><br><span class="line">vm.panic_on_oom=0 # 开启 00M</span><br><span class="line">fs, inotify.max_user_instances=8192</span><br><span class="line">fs, inotify.max_user_watches=1048576</span><br><span class="line">fs.file-max=52706963</span><br><span class="line">fs.nr_open=52706963</span><br><span class="line">net. ipv6.conf.all. disable_ipv6=l</span><br><span class="line">net.netfilter.nf_conntrack_max=2310720</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cp kubernetes.conf /etc/sysctl.d/kubernetes.conf</span><br><span class="line">sysctl -p /etc/sysctl.d/kubernetes.conf</span><br></pre></td></tr></table></figure>

<h3 id="调整系统时区"><a href="#调整系统时区" class="headerlink" title="调整系统时区"></a>调整系统时区</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 设置系统时区为中国/上海</span></span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将当前的UTC时间写入硬件时钟</span></span><br><span class="line">timedatectl set-local-rtc 0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启依赖于系统时间的服务</span></span><br><span class="line">systemctl restart rsyslog</span><br><span class="line">systemctl restart crond</span><br></pre></td></tr></table></figure>

<h3 id="关闭系统不需要服务"><a href="#关闭系统不需要服务" class="headerlink" title="关闭系统不需要服务"></a>关闭系统不需要服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop postfix &amp;&amp; systemctl disable postfix</span><br></pre></td></tr></table></figure>

<p>设置 rsyslogd 和 systemd journald</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/log/journal #持久化保存日志的目录</span><br><span class="line">mkdir /etc/systemd/journald.conf.d</span><br><span class="line">cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;EOF</span><br><span class="line">[Journal]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 持久化保存到磁盘</span></span><br><span class="line">Storage=persistent</span><br><span class="line"><span class="meta">#</span><span class="bash"> 压缩历史日志</span></span><br><span class="line">Compress=yes</span><br><span class="line">SyncIntervalSec=5m</span><br><span class="line">RateLimitInterval=30s</span><br><span class="line">RateLimitBurst=1000</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大占用空间10G</span></span><br><span class="line">SystemMaxllse=10G</span><br><span class="line"><span class="meta">#</span><span class="bash"> 单日志文件最大200M</span></span><br><span class="line">SystemMaxFileSize=200M</span><br><span class="line"><span class="meta">#</span><span class="bash"> 日志保存时间2周</span></span><br><span class="line">MaxRetentionSec=2week</span><br><span class="line"><span class="meta">#</span><span class="bash"> 不将日志转发到syslog</span></span><br><span class="line">ForwardToSyslog=no</span><br><span class="line">EOF</span><br><span class="line">systemctl restart systemd-journald</span><br></pre></td></tr></table></figure>

<h3 id="升级系统内核为-4-44"><a href="#升级系统内核为-4-44" class="headerlink" title="升级系统内核为 4.44"></a>升级系统内核为 4.44</h3><p>CentOS 7.x 系统自带的 3.10.x 内核—些 Bugs, 导致运行的 Docker、Kubernetes 不稳定，例 I 如：rpm-Uvh<br>httD：〃<a href="http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm" target="_blank" rel="noopener">www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm #安装完成后检查/boot/grub2/grub.cfg 中对应内核 menuentry 中是否包含 initrdl6 配置，如果没有，再安装 一次！</span><br><span class="line">yum --enablerepo=elrepo-kernel install -y kernel-lt #设置开机从新内核启动</span><br><span class="line">grub2-set-default 'CentOS Linux (4.4.189-1.el7.elrepo.x86_64) 7 (Core)'</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/Centos%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96/" data-id="clzmdspi800eyzwl10fzv0o3p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/centos/" rel="tag">centos</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-编程/k8s/环境搭建相关/k8sKubeadm部署安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/k8sKubeadm%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/" class="article-date">
  <time datetime="2022-08-06T15:59:06.000Z" itemprop="datePublished">2022-08-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/programming/">编程</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/k8sKubeadm%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/">Kubeadm 部署安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="kube-proxy-开启-ipvs-的前置条件"><a href="#kube-proxy-开启-ipvs-的前置条件" class="headerlink" title="kube-proxy 开启 ipvs 的前置条件"></a>kube-proxy 开启 ipvs 的前置条件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"></span><br><span class="line">cat &gt;/etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> modprobe -- nf_conntrack_ipv4 <span class="comment"># 4.x版本</span></span></span><br><span class="line">modprobe -- nf_conntrack # 5.x版本</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack</span><br></pre></td></tr></table></figure>

<h3 id="安装-Docker-软件"><a href="#安装-Docker-软件" class="headerlink" title="安装 Docker 软件"></a>安装 Docker 软件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data 1vm2</span><br><span class="line">yum-config-manager\</span><br><span class="line">  --add-repo\</span><br><span class="line">  http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum update -y &amp;&amp; yum install -y docker-ce</span><br><span class="line"></span><br><span class="line">＃ 创建／etc／docker 目录</span><br><span class="line">mkdir /etc/docker</span><br><span class="line"></span><br><span class="line">＃ 配置 daemon.</span><br><span class="line">cat &gt;/etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  "exec-opts": ["native.cgroupdriver=systemd"],</span><br><span class="line">  "log-driver": "json-file",</span><br><span class="line">  "log-opts":&#123;</span><br><span class="line">    "max-size":"100m"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mkdir -p /etc/systemd/system/docker.service.d ＃重启 docker 服务</span><br><span class="line">systemctl daemon-reload&amp;&amp; systemctl restart docker &amp;&amp; systemctl enable docker</span><br></pre></td></tr></table></figure>

<h3 id="安装-Kubeadm（主从配置）"><a href="#安装-Kubeadm（主从配置）" class="headerlink" title="安装 Kubeadm（主从配置）"></a>安装 Kubeadm（主从配置）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt;/etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgchec=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 都是 1.24.3</span></span><br><span class="line">yum -y install kubeadm kubectl kubelet</span><br><span class="line">systemctl enable kubelet.service</span><br><span class="line">systemctl status kubelet.service</span><br></pre></td></tr></table></figure>

<h3 id="初始化主节点（仅-master-节点）"><a href="#初始化主节点（仅-master-节点）" class="headerlink" title="初始化主节点（仅 master 节点）"></a>初始化主节点（仅 master 节点）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config print init-defaults&gt;kubeadm-config.yaml</span><br><span class="line"></span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 192.168.56.2</span><br><span class="line">kubernetesVersion: v1.24.3</span><br><span class="line">networking:</span><br><span class="line">  podSubnet: 10.244.0.0/16</span><br><span class="line">  serviceSubnet: 10.96.0.0/12</span><br><span class="line">---</span><br><span class="line">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="line">kind: KubeProxyConfiguration</span><br><span class="line"><span class="meta">#</span><span class="bash"> featureGates: 已经删掉该子段</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   SupportIPVSProxyMode: <span class="literal">true</span></span></span><br><span class="line">mode: ipvs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭swap 否则kubelet无法启动</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解决 unknown service runtime.v1alpha2.RuntimeService</span></span><br><span class="line">rm -f /etc/containerd/config.toml</span><br><span class="line">systemctl restart containerd</span><br><span class="line"></span><br><span class="line">kubeadm init --config=kubeadm-config.yaml --upload-certs | tee kubeadm-init.1og</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">kubeadm reset -f</span><br><span class="line">systemctl restart kubelet</span><br><span class="line">kubeadm init --config=kubeadm-config.yaml --upload-certs | tee kubeadm-init.1og</span><br></pre></td></tr></table></figure>

<h3 id="加入主节点以及其余工作节点"><a href="#加入主节点以及其余工作节点" class="headerlink" title="加入主节点以及其余工作节点"></a>加入主节点以及其余工作节点</h3><p>执行安装日志中的加入命令即可部署网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure>

<h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ol>
<li>coredns pod 无法启动<br>network: open /run/flannel/subnet.env: no such file or directory</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /run/flannel/</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /run/flannel/subnet.env &lt;&lt;EOF</span><br><span class="line">FLANNEL_NETWORK=10.244.0.0/16</span><br><span class="line">FLANNEL_SUBNET=10.244.0.1/24</span><br><span class="line">FLANNEL_MTU=1450</span><br><span class="line">FLANNEL_IPMASQ=true</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>无法访问 pod 的 ip</li>
</ol>
<p>双网卡导致的问题<br><a href="https://junjie2018.github.io/notes/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/kubernetes/kubernetes%E8%A7%A3%E5%86%B3%E8%BF%90%E8%A1%8C%E5%9C%A8%E4%B8%8D%E5%90%8C%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%9A%84pod%E6%97%A0%E6%B3%95ping%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/" target="_blank" rel="noopener">https://junjie2018.github.io/notes/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/kubernetes/kubernetes%E8%A7%A3%E5%86%B3%E8%BF%90%E8%A1%8C%E5%9C%A8%E4%B8%8D%E5%90%8C%E4%B8%BB%E6%9C%BA%E4%B8%8A%E7%9A%84pod%E6%97%A0%E6%B3%95ping%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/</a></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.jianshu.com/p/51542b0b239b" target="_blank" rel="noopener">https://www.jianshu.com/p/51542b0b239b</a><br><a href="https://blog.csdn.net/clareeee/article/details/121100431" target="_blank" rel="noopener">https://blog.csdn.net/clareeee/article/details/121100431</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ansike.github.io/blog/programming/%E7%BC%96%E7%A8%8B/k8s/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E7%9B%B8%E5%85%B3/k8sKubeadm%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85/" data-id="clzmdspi800f2zwl1838ga6kz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/centos/" rel="tag">centos</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/blog/page/8/">&lt; 上一页</a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/7/">7</a><a class="page-number" href="/blog/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/blog/page/10/">10</a><a class="page-number" href="/blog/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/21/">21</a><a class="extend next" rel="next" href="/blog/page/10/">下一页 &gt;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E4%B9%A6%E7%B1%8D/">书籍</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E6%B8%B8%E6%88%8F/">游戏</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/life/">生活</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/programming/">编程</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/english/">英语</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/BTC/" rel="tag">BTC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Dapp/" rel="tag">Dapp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ETH/" rel="tag">ETH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/PC%E7%AB%AF/" rel="tag">PC端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/awk/" rel="tag">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/book/" rel="tag">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/bytecode/" rel="tag">bytecode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/canvas/" rel="tag">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/cat/" rel="tag">cat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/centos/" rel="tag">centos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/clothes/" rel="tag">clothes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/cocos/" rel="tag">cocos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/computed/" rel="tag">computed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/curl/" rel="tag">curl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/debian/" rel="tag">debian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/economy/" rel="tag">economy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/encoding/" rel="tag">encoding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/error/" rel="tag">error</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/expect/" rel="tag">expect</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/food/" rel="tag">food</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/grep/" rel="tag">grep</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/language/" rel="tag">language</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/mac/" rel="tag">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/mail/" rel="tag">mail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/merge/" rel="tag">merge</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/network/" rel="tag">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/rebase/" rel="tag">rebase</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/restaurant/" rel="tag">restaurant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/sed/" rel="tag">sed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/svg/" rel="tag">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ts/" rel="tag">ts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/web3/" rel="tag">web3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%8A%A8%E7%94%BB/" rel="tag">动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%9B%BE%E8%A1%A8/" rel="tag">图表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="tag">基础概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%A4%A7%E5%B1%8F/" rel="tag">大屏</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%89%8B%E6%9C%BA%E7%AB%AF/" rel="tag">手机端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%8E%92%E7%89%88/" rel="tag">排版</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%91%84%E5%BD%B1/" rel="tag">摄影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%AD%A3%E5%88%99/" rel="tag">正则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/" rel="tag">路由器</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/BTC/" style="font-size: 16.67px;">BTC</a> <a href="/blog/tags/Dapp/" style="font-size: 10.83px;">Dapp</a> <a href="/blog/tags/ETH/" style="font-size: 15px;">ETH</a> <a href="/blog/tags/PC%E7%AB%AF/" style="font-size: 10px;">PC端</a> <a href="/blog/tags/awk/" style="font-size: 10px;">awk</a> <a href="/blog/tags/book/" style="font-size: 11.67px;">book</a> <a href="/blog/tags/bytecode/" style="font-size: 10px;">bytecode</a> <a href="/blog/tags/canvas/" style="font-size: 10.83px;">canvas</a> <a href="/blog/tags/cat/" style="font-size: 10px;">cat</a> <a href="/blog/tags/centos/" style="font-size: 10.83px;">centos</a> <a href="/blog/tags/clothes/" style="font-size: 10px;">clothes</a> <a href="/blog/tags/cocos/" style="font-size: 10px;">cocos</a> <a href="/blog/tags/computed/" style="font-size: 10px;">computed</a> <a href="/blog/tags/css/" style="font-size: 10px;">css</a> <a href="/blog/tags/curl/" style="font-size: 10px;">curl</a> <a href="/blog/tags/debian/" style="font-size: 10px;">debian</a> <a href="/blog/tags/docker/" style="font-size: 10px;">docker</a> <a href="/blog/tags/economy/" style="font-size: 11.67px;">economy</a> <a href="/blog/tags/encoding/" style="font-size: 10px;">encoding</a> <a href="/blog/tags/error/" style="font-size: 10px;">error</a> <a href="/blog/tags/expect/" style="font-size: 10px;">expect</a> <a href="/blog/tags/food/" style="font-size: 10px;">food</a> <a href="/blog/tags/git/" style="font-size: 11.67px;">git</a> <a href="/blog/tags/grep/" style="font-size: 10px;">grep</a> <a href="/blog/tags/http/" style="font-size: 10px;">http</a> <a href="/blog/tags/js/" style="font-size: 19.17px;">js</a> <a href="/blog/tags/k8s/" style="font-size: 16.67px;">k8s</a> <a href="/blog/tags/language/" style="font-size: 17.5px;">language</a> <a href="/blog/tags/linux/" style="font-size: 10px;">linux</a> <a href="/blog/tags/mac/" style="font-size: 10px;">mac</a> <a href="/blog/tags/mail/" style="font-size: 10px;">mail</a> <a href="/blog/tags/merge/" style="font-size: 10px;">merge</a> <a href="/blog/tags/mysql/" style="font-size: 14.17px;">mysql</a> <a href="/blog/tags/network/" style="font-size: 10px;">network</a> <a href="/blog/tags/node/" style="font-size: 11.67px;">node</a> <a href="/blog/tags/python/" style="font-size: 17.5px;">python</a> <a href="/blog/tags/react/" style="font-size: 10.83px;">react</a> <a href="/blog/tags/rebase/" style="font-size: 10px;">rebase</a> <a href="/blog/tags/restaurant/" style="font-size: 10px;">restaurant</a> <a href="/blog/tags/sed/" style="font-size: 10.83px;">sed</a> <a href="/blog/tags/shell/" style="font-size: 20px;">shell</a> <a href="/blog/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/blog/tags/svg/" style="font-size: 10px;">svg</a> <a href="/blog/tags/ts/" style="font-size: 10px;">ts</a> <a href="/blog/tags/vim/" style="font-size: 10px;">vim</a> <a href="/blog/tags/vue/" style="font-size: 10px;">vue</a> <a href="/blog/tags/web3/" style="font-size: 18.33px;">web3</a> <a href="/blog/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/blog/tags/%E5%8A%A8%E7%94%BB/" style="font-size: 11.67px;">动画</a> <a href="/blog/tags/%E5%9B%BE%E8%A1%A8/" style="font-size: 10px;">图表</a> <a href="/blog/tags/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" style="font-size: 13.33px;">基础概念</a> <a href="/blog/tags/%E5%A4%A7%E5%B1%8F/" style="font-size: 10px;">大屏</a> <a href="/blog/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" style="font-size: 11.67px;">工程化</a> <a href="/blog/tags/%E6%89%8B%E6%9C%BA%E7%AB%AF/" style="font-size: 10px;">手机端</a> <a href="/blog/tags/%E6%8E%92%E7%89%88/" style="font-size: 10px;">排版</a> <a href="/blog/tags/%E6%91%84%E5%BD%B1/" style="font-size: 10px;">摄影</a> <a href="/blog/tags/%E6%96%87%E6%A1%A3/" style="font-size: 10px;">文档</a> <a href="/blog/tags/%E6%AD%A3%E5%88%99/" style="font-size: 12.5px;">正则</a> <a href="/blog/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15.83px;">网络</a> <a href="/blog/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/" style="font-size: 10px;">路由器</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/05/">五月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/12/">十二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/09/">九月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/08/">八月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/07/">七月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/05/">五月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/03/">三月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/02/">二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/01/">一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/10/">十月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/06/">六月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/05/">五月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/04/">四月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/05/">五月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/life/%E7%94%9F%E6%B4%BB/%E6%91%84%E5%BD%B1/%E6%91%84%E5%BD%B1%E6%9E%84%E5%9B%BE%E6%8A%80%E5%B7%A7/">摄影构图技巧</a>
          </li>
        
          <li>
            <a href="/blog/%E5%89%8D%E7%AB%AF/%E7%BC%96%E7%A8%8B/%E5%A4%A7%E5%B1%8F/bigscreen/">大屏项目</a>
          </li>
        
          <li>
            <a href="/blog/programming/%E7%BC%96%E7%A8%8B/js/%E9%87%8D%E5%AD%A6js/array/">array</a>
          </li>
        
          <li>
            <a href="/blog/programming/%E7%BC%96%E7%A8%8B/css/UI%E9%80%82%E9%85%8D/">UI适配</a>
          </li>
        
          <li>
            <a href="/blog/programming/%E7%BC%96%E7%A8%8B/msyql/%E9%94%81/">mysql 的锁</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 ask<br>
      <!-- Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> -->
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">首页</a>
  
    <a href="/blog/archives" class="mobile-nav-link">归档</a>
  
</nav>
    

<script src="//code.jquery.com/jquery-2.2.4.min.js"></script>

 
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
 
<script src="/blog/fancybox/jquery.fancybox.pack.js"></script>
  
<script src="/blog/js/script.js"></script>
 
<script src="/blog/js/search_form.js"></script>
 


  </div>
</body>
</html>