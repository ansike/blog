---
title: The Dao
categories: 编程
tags:
  - web3
  - ETH
date: 2023-01-15 16:24:22
---

本系列开始区块链的学习，主要内容为B站上[北京大学肖臻老师《区块链技术与应用》公开课](https://www.bilibili.com/video/BV1Vt411X7JF?p=1&vd_source=22653c02dfbe0c9c7bb4a200eb87fe4e)

DAC(Decentralized Automatics Corporation)
DAO(Decentralized Automatics Organization) 本质是运行在ETH的智能合约
DAO是去中心化自治组织。其目的是为组织规则以及决策机构编写代码，从而消除书面文件的需要，以及减少管理人员，从而创建出一个去中心化管理架构。

**DAO的运作方式：**
- 一组人来编写运行组织的智能合约（程序）
- 有初始融资阶段，在这一阶段人们添加资金来购买代币，来代表其所有权--这个过程叫做众销，或者首次代币发行（ICO）--为其提供所需资源。
- 当融资阶段结束后，DAO就开始运行。
- 之后人们就开始向DAO建言献策如何使用这笔钱，购买DAO的成员就有资格对这些天进行投票。

**DAO资金回收方式**
DAO取回资产的方式是通过拆分实现的。从原有的DAO上拆分出一部分叫split DAO或者叫child DAO，拆分的DAO可以把ETH发给自己或者投资新的项目。拆分之前有7天的辩论期，拆分之后有28天的锁定期。

**黑客攻击ETH的The DAO案例**

2016年6月17日，以太坊创始人V神心急如焚，急匆匆在Reddit上发了一篇帖子“DAO遭到攻击。攻击事件由此拉开序幕。

2016年4月30 日，The DAO项目开始众筹。项目代币DAO，众筹时间为期28天，代币价格大约是100个DAO兑换1至1.5个以太坊。The DAO项目总共筹到了超过1200万个以太坊，几乎占到了当时以太坊数量的14%，当时价值超过1.5亿美金，参与众筹的人数超过11000人。

The DAO是当时最大的众筹项目。这超出了很多人的想象，项目团队自己都没想到。众筹结束后，各交易所纷纷上架DAO代币，开始交易，一片其乐融融的景象。

6月17日，黑客利用The DAO代码里的一个递归漏洞，不停地从The DAO 资金池里分离资产；随后，黑客利用了The DAO的第二个漏洞，避免分离后的资产被销毁。

因为代码里规定，要过28天之后才能提现，这给了社区足够的时间研究对策。

经过紧急磋商，V神不久就在以太坊官方博客发布公告《紧急状态更新：关于DAO的漏洞》。V神在公告中，解释了这次攻击的一些细节问题，同时提到已经提交了软分叉的建议（不会回滚，也不会撤销交易和区块）。

受此事件影响，以太坊价格第二天暴跌约30%。

很快很多矿工接受了软分叉的建议纷纷安装了新的软件。但是很快暴露了一个问题，ETH在执行合约检查地址发生错误的时候没有收取gas fee，导致网上发生了很多的（0成本）DOS攻击。于是矿工纷纷又回滚了软件升级，宣告软分叉失败。

随后ETH又设计了一个硬分叉方案：通过软件升级的方法将The DAO上的资金强行转到另外一个智能合约上，这个新的智能合约只有一个功能就是退钱。本来转账是需要合法的签名才能进行转账的，但是现在新的代码里对The DAO的账户没有这个限制，可以直接将The DAO账户的资金无论本人是否同意都转移到一个新的智能合约。升级的软件规定了具体执行的日期，挖到第192w个区块，自动执行该交易。

该方案产出之后引起了很大的讨论，最后是通过投票的方式决定的。结果是大部分人同意硬分叉，绝大多数矿工们也都升级了该软件，最后硬分叉成功了。

**反对硬分叉的人认为不合理**
- 很多ETH的持有人并没有参加投票。
- 投票不能说明问题。

硬分叉之后旧链还是存在的叫ETC，新链继承原来的名字ETH。

**为什么ETH团队要插手这次事故？**
The DAO对ETH来说已经是too big to fail.

两条链存在了很多问题：典型的是重放攻击（新旧链都是可以在对方的链上进行重放的 解决方案是加了chain id）

**为什么要把所有的钱转走，而不是直接把黑客账户上的钱转走返回给原来的账户呢？**
因为之前The DAO的bug是一直会存在区块链上的。如果The DAO还存在，之后可能还会有人来利用该漏洞来攻击。所以智能合约只要存在漏洞，在区块链上是必须销毁的。