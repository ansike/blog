---
title: BTC-挖矿
categories: 编程
tags:
  - web3
  - BTC
date: 2022-12-30 20:00:23
---

本系列开始区块链的学习，主要内容为B站上[北京大学肖臻老师《区块链技术与应用》公开课](https://www.bilibili.com/video/BV1Vt411X7JF?p=1&vd_source=22653c02dfbe0c9c7bb4a200eb87fe4e)

### 全节点和轻节点的职责
- 全节点
  - 一直在线
  - 在本地的硬盘上维护完整的区块链信息
  - 监听比特币网络上的交易信息，验证每个交易的合法性
  - 决定哪些交易会被打包到区块里
  - 监听别的矿工挖出来的区块，验证其合法性
  - 挖矿
    - 决定沿着哪条链继续挖下去？
    - 出现等长链时选择哪个分叉
- 轻节点
  - 不是一直在线
  - 不用保存整个区块链，只要保存每个区块的块头
  - 不用保存全部交易，只保存于自己相关的交易
  - 无法校验大多数交易的合法性，只能检验与自己相关的那些交易的合法性。
  - 无法检测网上发布的区块的正确性
  - 可以验证挖矿的难度
  - 只能检测哪个时最长链，不知道哪个时最长合法链。


### 挖矿中的注意事项

挖矿的过程中发现别人已经发现别人已经挖出了新的区块且在最长合法链上，此时应该立即停止当前的挖矿，构建新的区块开始挖。这样看起来是比较可惜的，因为挖矿的性质是无记忆性（memoryless或progress free），不论前边挖了多长时间，新组装区块和现在接着去挖成功率是一样的。
即使挖到了合法的区块，发布到区块链上也不一定就胜利了。有可能发布的区块没有成为最长合法链，存在一些race condition。

### BTC怎么保证安全性的？
1. 密码学保证
2. 共识机制保证
二者必须是一起保证的

### 挖矿的设备
最早的是CPU挖矿，后来发展到了GPU挖矿，现在用到了ASIC芯片。
比特币挖矿主要用到了整数计算，基本用不了多少内存和硬盘，所以对于CPU挖矿和GPU挖矿来说都是效率很低的，ASIC是专门为挖矿设计生产的芯片。

### 矿池
矿池就是把很多的矿工聚集到一起
两个身份：
- 矿主 负责全节点的其他职责
- 矿工 负责计算hash值

怎么计算分红：工作量证明
矿主自己提出一个降低挖矿难度的nonce值，然后交给矿工去进行挖矿，矿工挖到的区块叫almost valid block。这些share就是矿工的工作量证明。这些计算出的结果仅仅做矿工的工作量证明用作后续出块的分红。

矿工有没有办法偷偷出块奖励？
只要矿工是按照矿主交给他的任务，那么备选区块中的收益地址就是矿主的地址，矿工是没有办法修改的。但如果他刚开始就是自己构造区块去挖，那么他的share矿主是不认的，也就相当于是自己在挖矿。

GHash矿池曾经超过了总算力的50%，造成了一定的恐慌，后便GHash主动缩减了自己的算力，当然也有可能是拆分了自己的矿池。

### 算力很大之后的危害
1. forking attack分叉攻击
2. Boycott 账户封杀，可以故意不打包某个账户
3. 盗币是不可能的