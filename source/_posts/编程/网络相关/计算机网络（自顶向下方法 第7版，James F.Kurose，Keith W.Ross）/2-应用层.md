---
title: 应用层
categories: 编程
tags:
  - 网络
date: 2023-05-04 17:35:01
---

来自[中科大郑烇、杨坚全套《计算机网络（自顶向下方法 第7版，James F.Kurose，Keith W.Ross）》课程](https://www.bilibili.com/video/BV1JV411t7ow/?spm_id_from=333.337.search-card.all.click&vd_source=22653c02dfbe0c9c7bb4a200eb87fe4e)


<a href="#overview">2.0 应用层概述</a>
<a href="#protocol">2.1 应用层协议原理</a>
<a href="#web">2.2 Web and HTTP</a>
<a href="#ftp">2.3 FTP*</a>
<a href="#email">2.4 Email，SMTP，POP3，IMAP</a>
<a href="#dns">2.5 DNS</a>
<a href="#p2p">2.6 P2P应用</a>
<a href="#cdn">2.7 CDN</a>
<a href="#tcp">2.8 TCP套接字（Socket）编程</a>
<a href="#udp">2.9 UDP套接字编程</a>

<h1 id="overview">2.0 应用层概述</h1>
{% asset_img 20230504-115306.jpeg 概述 %}


<h1 id="protocol">2.1 应用层协议原理</h1>

{% asset_img 20230504-115954.jpeg 网络应用的例子 %}

### 网络应用的体系结构
- 客户-服务器模式（C/S client/service）
  - 服务器
    - 一直运行
    - 固定的IP地址和周知的端口号
    - 扩展性差，数据中心进行扩展
  - 客户端
    - 主动与服务器通信
    - 与互联网有间歇性的连接
    - 可能是动态IP地址
    - 不直接与其他客户端通信
- 对等模式（P2P Peer To Peer）
  - （几乎）没有一直运行的服务器
  - 任意端系统之间可以进行通信
  - 每个节点即是客户端又是服务器
    - 自扩展性-新peer节点带来新的服务能力，当然也带来新的服务请求
  - 参与的主机间歇性连接且可以改变IP地址（难以管理）
  - 例子：Gnutella，迅雷
- 混合体：客户服务器和对等体系结构
  - Napster
    - 文件搜索：集中
      - 主机在中心服务器上注册其资源
      - 主机在中心服务器查询资源位置
    - 文件传输： P2P
      - 任意Peer节点之间
  - 即时通信
    - 在线检测：集中
      - 当用户上线时，向中心服务器注册其IP地址
      - 用户与中心服务器联系，以找到其在线好友的位置
    - 两个用户之间聊天 P2P

### 进程通信
进程：在主机上运行的应用程序
- 在同一个主机内，使用进程间通信机制通信（操作系统定义）
- 不同主机，通过交换报文（Message）来通信
  - 使用OS提供的通信服务
  - 按应用协议交换报文（借助传输层提供的服务）

**clients servers**
- 客户端进程：发起通信的进程
- 服务器进程：等待连接的进程

> P2P架构的应用也有客户端进程和服务器进程之分

### 分布式进程通信需要解决的问题
1. 进程表示和寻址问题（服务用户）
2. 传输层-应用层提供服务时如何（服务）
   1. 位置：层间界面的SAP（TCP/IP socket）
   2. 形式：应用程序接口API（TCP/IP socket api）
3. 如何使用传输层提供的服务，实现应用进程之间的报文交换，实现应用（用户使用服务）
   1. 定义应用层协议：报文格式，解释，时序等
   2. 编制程序，使用OS提供的API，调用网络基础设施提供通信服务传报文，实现应用时序等；

### 对进程进行编址（addressing）
-  进程为了接受报文，必须有一个标识即：SAP（发送也需要标示）
   -  主机：为一个32位IP地址
      -  仅仅有IP地址不能唯一标识一个进程，在一台端系统上有很多应用进程在运行
   - 所采用的传输层协议：TCP or UDP
   - 端口号（Port Numbers）
- 一些知名端口号的例子
  - HTTP TCP 80
  - Mail TCP 25
  - ftp TCP 21
- 一个进程： 用IP+port标示端节点
- 本质上，一对主机进程之间的通信由两个端节点构成

### 传输层提供的服务-层间信息的代码
- 如果socket api每次传输报文，都携带如此多的信息，太繁琐易错，不便于管理
- 用个代号标示通信的双方或者单方：socket
- 就像OS打开文件返回的句柄意义
  - 对句柄的操作，就是对文件的操作
- TCP socket
  - TCP服务，对两个进程之间的通信需要之前要建立连接
    - 两个进程通信会持续一段时间，通信关系稳定
  - 可以用一个证书表示两个应用实体之间的通信关系，本地标识
  - 穿过层间接口的信息量最小
  - TCP socket：源IP，源端口，目标IP，目标端口
- UDP socket
  - UDP服务，两个进程之间的通信需要之前无需建立连接
    - 每个报文都是独立传输的
    - 前后报文可能给不同的分布式进程
  - 因此只能用一个整数表示本应用实体的标示
    - 因为这个报文可能传给另外一个分布式进程
  - 穿过层间接口的信息大小最小
  - UDP socket 2元组（本IP 本端口）
  - 但是传输报文时，必须要提高对方IP，port
    - 接受报文时，传输层需要上传对方的IP，port

### TCP之上的套接字（Socket）
对于使用面向连接服务（TCP）的应用而言，套接字是4元组的一个具有本地意义的标示
- 4元组（源IP，源port，目标IP，目标port）
- 唯一指定了一个会话（两个进程之间的会话关系）
- 应用使用这个标识，与远程的应用程序通信
- 不必在每个报文的发送都要指定这4元组
- 就像使用操作系统打开一个文件，OS返回一个文件句柄一样，以后使用这个文件句柄，而不是使用这个文件的目录名、文件名
- 简单，便于管理

### UDP之上的套接字（Socket）
对于使用无连接服务（UDP）的应用而言，套接字是2元组的一个具有本地意义的标示
  2元组（源IP，源port）
- UDP套接字指定了应用所在的一个端节点（end point）
- 在发送数据报时，采用创建好的本地套接字（标识ID），就不必在发送每个报文中指明白自己所采用的ip和port
- 但是在发送报文时必须要指定对方的ip和UDP port

### 安全TCP
- TCP & UDP
  - 都没有加密
  - 明文通过互联网传输，甚至密码
- SSL
  - 在TCP上面实现，提供加密的TCP连接
  - 私密性
  - 数据完整性
  - 端到端的鉴别
- SSL在应用层
  - 应用采用SSL库，SSL库使用TCP通信
- SSL socket API
  - 应用通过API将明文交给socket，SSL将其加密在互联网上传输



<h1 id="web">2.2 Web and HTTP</h1>

<h1 id="ftp">2.3 FTP*</h1>
<h1 id="email">2.4 Email，SMTP，POP3，IMAP</h1>
<h1 id="dns">2.5 DNS</h1>
<h1 id="p2p">2.6 P2P应用</h1>
<h1 id="cdn">2.7 CDN</h1>
<h1 id="tcp">2.8 TCP套接字（Socket）编程</h1>
<h1 id="udp">2.9 UDP套接字编程</h1>
