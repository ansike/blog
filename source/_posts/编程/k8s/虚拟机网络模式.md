---
title: 虚拟机网络的模式
categories: 编程
tags:
  - network
date: 2022-07-23 22:00:18
---

虚拟机的三种网络模式: 网络地址转换模式、桥接模式、仅主机模式

下面以 virtualbox 为例进行解释

> 版本 6.1.36 r152435 (Qt5.6.3)

### 网络地址转换模式（NAT）

**nat 是什么**
nat 为 network address transform 网络地址转换，一般在涉及公网和局域网要进行数据包交换时需要进行网络地址转换。

该模式下会用到虚拟网卡，该网卡不直接和外网进行通信，只作为和主机通信的接口。只要主机能访问网络，且虚拟网卡可与主机进行联通，那虚拟机就可以通过主机访问网络（不需要配置 IP，子网掩码，网关等）

设置完成进入主机之后可以查看网络配置，如果此时网卡出现 10 网断 ip 地址说明配置正常

**主机和虚拟机关系？**
结论: 主机不可以访问虚拟机，虚拟机可以访问主机的网络，虚拟机之间不能互相访问
原因: 虚拟机被分配的网卡为 10 开头的 ip，此时可通过主机的网络访问互联网，也可访问主机 ip。多个虚拟机被分配的网卡是可能相同的，由此也可看出多个主机之间必然是完全隔离的。

**优劣分析**
优势: 最简单的网络配置方式，可访问互联网（也不需要配置 DHCP 进行分配即可）
劣势: 主机无法访问虚拟机，虚拟机之前也无法互相访问，应用场景比较小。

### 桥接模式（Bridged）

通过虚拟网桥将主机的网卡和虚拟交换机连接在一起，虚拟机的虚拟网卡都要连接在虚拟交换机上。所以桥接模式的虚拟机需要保证与主机在同一网段并且网关，DNS 和主网卡一致

虚拟机和主机的级别一致

1. 设置虚拟机的网络连接方式桥接模式模式: 选择对应虚拟机=>设置=>网络=>连接方式选桥接网络
2. 查看本机 ip，子网掩码，网关，DNS 等信息
3. 登录虚拟机，配置网卡

```shell
# 选择正确的网卡进行配置
vi /etc/sysconfig/network-scripts/ifcfg-enp0s3
# 可以通过 mac 地址对比确认，机器中ip a查看网卡所有的mac地址
# 第一步的网卡选择的高级选项可以看到网卡的mac地址

# TYPE=Ethernet
# BOOTPROTO=static # 设置为静态IP
# DEFROUTE=yes
# IPV4_FAILURE_FATAL=no
# NAME=enp0s3
# UUID=79b9344a-8e4c-4fe6-ac55-ec58499cfe07
# DEVICE=enp0s3
# ONBOOT=yes # 设置开启启动
# IPADDR=192.168.0.20 # 保证和主机ip在同一网段 主机ip为192.168.0.102
# NETMASK=255.255.255.0 # 子网掩码，网关，DNS保证和主机IP一致
# GATEWAY=192.168.0.1
# DNS1=192.168.0.1

# 编辑之后网卡之后进行网络服务重启
systemctl restart network

# 虚拟机ping主机
ping 192.168.0.102

# 主机ping虚拟机
ping 192.168.0.20
```

### 仅主机模式（Host-Only）

是比 NAT 更封闭的网络模式。
该模式下创建了一个基于宿主机的虚拟局域网，局域网内的虚拟机通过宿主机上的虚拟网卡进行联通。
此时宿主机可以访问虚拟机，虚拟机不能访问宿主机和外网。

```shell
# 此时可以在宿主机上进行ping
ping [虚拟机ip]
# 或者ssh登录
ssh root@[虚拟机ip]
```

### 网卡混杂模式

网卡有混杂模式，在混杂模式下，所有的流量都会流经 CPU，而不是仅传递专门的处理器中。该模式一般用来进行数据嗅探

### 如何设置自己的网络呢

https://www.jianshu.com/p/6139ffd686de
设置一个 nat 网卡，方便虚拟机访问外网
设置一个 hostonly 网卡，方便主机访问虚拟机
